# craftr_module(nr.container_object)

import craftr
append_search_path('..')
load_module('maxon.c4d')
load_module('platform')

objects = maxon.c4d.objects(
  sources = glob('src/**/*.cpp'),
  options = dict(
    includes = [project_dir, local('include'), local('res/description')],
    legacy_api = True,
  )
)

plugin = maxon.c4d.plugin(
  filename = local('{}-r{}'.format(module.identifier, maxon.c4d.release)),
  inputs = [objects],
  default = True,
)

def archive():
  outfile = '{}-r{}-{}.zip'.format(module.identifier, maxon.c4d.release, platform.id)
  craftr.utils.build_archive(
    prefix = rmvsuffix(basename(args.output)),
    filename = outfile,
    base_dir = project_dir,
    include = [
      'res',
      'README.md',
      'CHANGELOG.md',
      'LICENSE.txt',
      plugin.outputs[0],
    ],
  )
