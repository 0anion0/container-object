# @creator.unit.name = nr.c4d.container_object
#
# Copyright (C) 2013-2015, Niklas Rosenstein
# All rights reserved.
#
# Licensed under the GNU Lesser General Public License.

define('maxon.c4d:legacy', '')

workspace.path.append(eval('$ProjectPath/..'))
load('maxon.c4d', 'c4d')

# Path to the source file directory and build output directory (for
# object files).
define('SourceDir', '$ProjectPath/src')
define('BuildDir', '$ProjectPath/build/$c4d:arch-$c4d:mode')

# List of all source files that are to be built and their object files.
define('Sources', '$*($SourceDir/*.cpp,$SourceDir/*/*.cpp,$SourceDir/*/*/*.cpp)')
define('Objects', '$(c4d:obj $(move $Sources,$SourceDir,$BuildDir))')

# Additional include directories.
define('Includes', '$ProjectPath;$ProjectPath/res;$ProjectPath/res/description;$SourceDir')
define('Libs', '')

# Output filename of the plugin.
define('ProjectName', 'container-object')
define('Plugin', '$(c4d:cdl $ProjectPath/$ProjectName)')

@target()
def objects():
  for fin, fout in foreach_split('$Sources', '$Objects'):
    objects.add('$fin', '$fout', '$(c4d:compile $@) $"< $(c4d:include $Includes)')

@target(objects, 'maxon.c4d:library')
def plugin():
  plugin.add('$Objects', '$Plugin', '$(c4d:link $@) $!Libs $!<')
